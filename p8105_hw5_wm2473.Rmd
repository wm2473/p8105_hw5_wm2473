---
title: "p8105_hw5_wm2473"
output: github_document
date: "2022-11-14"
---

```{r}
library(tidyverse)
library(readxl)
library(rvest)
library(ggplot2)
set.seed(1)

```

Problem 2
```{r}
#Describe the raw data.?? 
hd = read_csv("homicide-data.csv") %>% 
  janitor::clean_names() %>% 
   mutate(city_state = str_c(city,",", state), 
         homicides = case_when(disposition == "Closed without arrest" ~ "unsolved homicides", disposition == "Open/No arrest" ~ "unsolved homicides", disposition == "Closed by arrest" ~ "solved homicides")) %>%
  filter(city_state != "TulsaAL") %>% 
  relocate(city_state)


hd %>% 
  group_by(city_state, homicides) %>% 
  count() %>% 
  knitr::kable()
```


```{r}
Baltimore = hd %>%
  filter(city_state == "Baltimore,MD") %>%  
  summarise(
    unsolved = sum(homicides == "unsolved homicides"),
    n = n()
  )

Baltimore_test = 
  prop.test(
    x = Baltimore %>% pull(unsolved),
    n = Baltimore %>% pull(n))

Baltimore_test %>% 
  broom::tidy() 
```

Prop.test for each of the city
```{r}
city_proptest = function(city_df){
  city_summarize = city_df %>%
  summarise(
    unsolved = sum(homicides == "unsolved homicides"),
    n = n())
  
  city_test = 
  prop.test(
    x = city_summarize %>% pull(unsolved),
    n = city_summarize %>% pull(n))
  
  return(city_test)
}
```

```{r}
nested_df = hd %>%
  nest(alldata = uid:homicides) %>% 
  mutate(
    test_results = map(alldata, city_proptest),
    cleanresults = map(test_results, broom::tidy)
  ) %>% 
  select(city_state, cleanresults) %>% 
  unnest(cleanresults) %>% 
  select(city_state, estimate, starts_with("conf"))
```
Creat the plot
```{r}
nested_df %>% 
  mutate(city_state = fct_reorder(city_state, estimate)) %>%
  ggplot(aes(x = city_state, y = estimate)) +
  geom_point()+geom_errorbar(aes(ymin = conf.low, ymax = conf.high))+
  theme(axis.text.x = element_text(angle = 90, hjust = 1), 
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Estimate vale among different city with errorbar",
       x = "City(State)",
       y = "Estimate") 
```

Problem 3
```{r}
output = vector("list", 5000)

for (i in 1:5000) {
  output[[i]] = (t.test(rnorm(n = 30, mean = 0, sd = 5), mu = 0, conf.level = 0.95)) %>% 
    broom::tidy()
}

```

t_test function
```{r}
norm_and_t_test = function(mu) {
  
  sim_data = tibble(
    x = rnorm(n = 30, mean = mu, sd = 5),
  )  
  sim_data %>%
    summarize(t.test(x, mu = 0, conf.level = 0.95, alternative = "two.sided")) %>%
    broom::tidy() %>% 
    select(estimate, p.value)
}

```

