---
title: "p8105_hw5_wm2473"
output: github_document
date: "2022-11-14"
---

```{r}
library(tidyverse)
library(readxl)
library(rvest)
library(ggplot2)
set.seed(1)

```

```{r}
#Describe the raw data.?? 
hd = read_csv("homicide-data.csv") %>% 
  janitor::clean_names() %>% 
   mutate(city_state = str_c(city,",", state), 
         homicides = case_when(disposition == "Closed without arrest" ~ "unsolved homicides", disposition == "Open/No arrest" ~ "unsolved homicides", disposition == "Closed by arrest" ~ "solved homicides")) %>%
  filter(city_state != "TulsaAL") %>% 
  relocate(city_state)


hd %>% 
  group_by(city_state, homicides) %>% 
  count() %>% 
  knitr::kable()
```


```{r}
Baltimore = hd %>%
  filter(city_state == "Baltimore,MD") %>%  
  summarise(
    unsolved = sum(homicides == "unsolved homicides"),
    n = n()
  )

Baltimore_test = 
  prop.test(
    x = Baltimore %>% pull(unsolved),
    n = Baltimore %>% pull(n))

Baltimore_test %>% 
  broom::tidy() 
```

Prop.test for each of the city
```{r}
city_proptest = function(hd){
  city_summarize = hd %>%
  summarise(
    unsolved = sum(homicides == "unsolved homicides"),
    n = n())
  
  city_test = 
  prop.test(
    x = city_summarize %>% pull(unsolved),
    n = city_summarize %>% pull(n))
  
  return(city_test)
}
```

```{r}
nested_df = hd %>%
  nest(data = uid:homicides) %>% 
  mutate(
    test_results = map(data, city_proptest),
    tidy_results = map(test_results, broom::tidy)
  ) 
```

